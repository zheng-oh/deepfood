"use strict";const a=require("../common/vendor.js"),t=require("../api/store.js"),l={__name:"DrawImg",setup(c){const e=a.ref({tagwidth_source:750,tagheight_source:1e3,tagwidth:0,tagheight:0,width:0,height:0}),h=i=>{if(t.store.imgInfo.url==="")return;console.log("执行了DrawImg:",t.store.imgInfo.url),e.value.tagwidth=e.value.tagwidth_source,e.value.tagheight=e.value.tagheight_source,t.store.imgInfo.ratio=t.store.imgInfo.width/t.store.imgInfo.height;const n=e.value.tagwidth/e.value.tagheight;t.store.imgInfo.ratio>n?(e.value.width=a.index.getSystemInfoSync().screenWidth,e.value.height=Math.round(e.value.width/t.store.imgInfo.ratio),e.value.tagheight=Math.round(e.value.tagwidth/t.store.imgInfo.ratio),t.store.imgInfo.is_kuan=!0):(e.value.height=e.value.tagheight,e.value.width=Math.round(e.value.height*t.store.imgInfo.ratio),e.value.tagwidth=Math.round(e.value.tagheight*t.store.imgInfo.ratio),t.store.imgInfo.is_kuan=!1),typeof i=="function"&&(console.log("进入了callback"),setTimeout(()=>{console.log("进入了setTimeout")},100))},u=()=>{a.index.createSelectorQuery().select("#myCanvas").fields({node:!0,size:!0}).exec(n=>{const o=n[0].node;if(o){ctx.value=o.getContext("2d"),o.width=e.value.width*drp.value,o.height=e.value.height*drp.value;const r=o.createImage();r.src=imgInfo.value.url,r.onload=()=>{ctx.value.drawImage(r,0,0,o.width,o.height);const g=ctx.value.getImageData(0,0,o.width,o.height);imgInfo.value.data=g,imgInfo.value.is_kuan?(touchInfo.value.y_ratio=1,touchInfo.value.x_ratio=1):(touchInfo.value.y_ratio=e.value.height/Math.max(n[0].height,n[0].width),touchInfo.value.x_ratio=touchInfo.value.y_ratio)}}else console.error("Canvas element not found.")})};return a.watch(t.store,()=>{console.log("1",t.store.imgInfo.url),h(u)}),(i,n)=>a.e({a:a.unref(t.store).imgInfo.url},a.unref(t.store).imgInfo.url?{b:a.o((...o)=>i.handleTouchStart&&i.handleTouchStart(...o)),c:a.o((...o)=>i.handleTouchMove&&i.handleTouchMove(...o)),d:a.o((...o)=>i.handleTouchEnd&&i.handleTouchEnd(...o)),e:e.value.tagwidth+"rpx",f:e.value.tagheight+"rpx"}:{})}},s=a._export_sfc(l,[["__file","C:/Users/zxing/Desktop/pickercolor/components/DrawImg.vue"]]);wx.createComponent(s);
