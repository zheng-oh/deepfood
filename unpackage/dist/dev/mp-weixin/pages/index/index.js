"use strict";const h=require("../../common/vendor.js"),g={data(){return{pickerColors:[],pickerColor:{red:0,green:0,blue:0},imgInfo:{width:0,height:0,url:"",data:[],ratio:1,is_kuan:!1},canvasInfo:{tagwidth_source:750,tagheight_source:1e3,tagwidth:0,tagheight:0,width:0,height:0},cursorInfo:{x:100,y:100,radius:60,lineWidth:20,color:"red"},touchInfo:{x:0,y:0,x_ratio:1,y_ratio:1,isDragging:!1},ctx:null,drp:0,rgb:"",hexColor:"",squareSize:40}},methods:{sendPickerColors(){h.index.$emit("pickerColorsEvent",this.pickerColors)},deleteImage(){this.imgInfo.url=""},addImage(){h.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{const s=e.tempFilePaths;this.imgInfo.url=s[0],h.index.getImageInfo({src:s[0],success:t=>{this.imgInfo.url=t.path,this.imgInfo.width=t.width,this.imgInfo.height=t.height,console.log("imgInfo",this.imgInfo),this.canvasInfo.tagwidth=this.canvasInfo.tagwidth_source,this.canvasInfo.tagheight=this.canvasInfo.tagheight_source,setTimeout(()=>{this.setCanvas(()=>{this.drawImage()})},100),this.drp=h.index.getSystemInfoSync().pixelRatio,console.log("系统真实dpr:",this.drp),console.log("系统真实宽度：",h.index.getSystemInfoSync().screenWidth)}})}})},addToDB(){this.pickerColors.push(this.pickerColor),console.log("发送pickerColors:",this.pickerColors),this.sendPickerColors()},setCanvas(e){this.canvasInfo.tagwidth=this.canvasInfo.tagwidth_source,this.canvasInfo.tagheight=this.canvasInfo.tagheight_source,this.imgInfo.ratio=this.imgInfo.width/this.imgInfo.height;const s=this.canvasInfo.tagwidth/this.canvasInfo.tagheight;this.imgInfo.ratio>s?(console.log("照片宽对齐屏幕"),this.canvasInfo.width=h.index.getSystemInfoSync().screenWidth,this.canvasInfo.height=Math.round(this.canvasInfo.width/this.imgInfo.ratio),this.canvasInfo.tagheight=Math.round(this.canvasInfo.tagwidth/this.imgInfo.ratio),this.imgInfo.is_kuan=!0,console.log("canvasInfo",this.canvasInfo)):(console.log("照片高对齐屏幕"),this.canvasInfo.height=this.canvasInfo.tagheight,this.canvasInfo.width=Math.round(this.canvasInfo.height*this.imgInfo.ratio),this.canvasInfo.tagwidth=Math.round(this.canvasInfo.tagheight*this.imgInfo.ratio),console.log("canvasInfo",this.canvasInfo),this.imgInfo.is_kuan=!1),typeof e=="function"&&e()},drawImage(){console.log("start draw"),h.index.createSelectorQuery().select("#myCanvas").fields({node:!0,size:!0}).exec(s=>{console.log("ress:",s);const t=s[0].node;if(console.log("<canvas> size:",s[0].width,s[0].height),t){this.ctx=t.getContext("2d"),t.width=this.canvasInfo.width*this.drp,t.height=this.canvasInfo.height*this.drp,console.log("canvas w;h:",t.width,t.height);const r=t.createImage();r.src=this.imgInfo.url,r.onload=()=>{console.log(),this.ctx.drawImage(r,0,0,t.width,t.height);const o=this.ctx.getImageData(0,0,t.width,t.height);this.imgInfo.data=o,console.log("imageData:",o),console.log("kkk:",this.canvasInfo.height,Math.max(s[0].height,s[0].width)),this.imgInfo.is_kuan?(this.touchInfo.y_ratio=1,this.touchInfo.x_ratio=1):(this.touchInfo.y_ratio=this.canvasInfo.height/Math.max(s[0].height,s[0].width),this.touchInfo.x_ratio=this.touchInfo.y_ratio)}}else console.error("Canvas element not found.")})},drawCursor(){this.ctx.beginPath(),this.ctx.lineWidth=this.cursorInfo.lineWidth,this.ctx.moveTo(this.cursorInfo.x,this.cursorInfo.y-this.cursorInfo.radius),this.ctx.lineTo(this.cursorInfo.x,this.cursorInfo.y+this.cursorInfo.radius),this.ctx.moveTo(this.cursorInfo.x-this.cursorInfo.radius,this.cursorInfo.y),this.ctx.lineTo(this.cursorInfo.x+this.cursorInfo.radius,this.cursorInfo.y),this.ctx.strokeStyle=this.cursorInfo.color,this.ctx.stroke()},getImageRGB(){console.log("touchInfo:",this.touchInfo);const e=Math.round(this.cursorInfo.x),t=(Math.round(this.cursorInfo.y)*this.imgInfo.data.width+e)*4;console.log("pixelIndex:",t);const r=this.imgInfo.data.data[t],o=this.imgInfo.data.data[t+1],i=this.imgInfo.data.data[t+2];return this.hexColor=this.rgbToHex(r,o,i),this.rgb=`RGB(${r}, ${o}, ${i})  Hex(${this.hexColor})`,{red:r,green:o,blue:i}},rgbToHex(e,s,t){const r=a=>{const c=a.toString(16);return c.length===1?"0"+c:c},o=r(e),i=r(s),n=r(t);return`#${o}${i}${n}`},setCursorColor(e){this.cursorInfo.color=e,this.drawImage(),console.log("draw cursor")},handleTouchStart(e){const s=e.touches[0];this.touchInfo.x=Math.round(s.x),this.touchInfo.y=Math.round(s.y),console.log("touchInfo:",this.touchInfo),this.imgInfo.is_kuan?(this.cursorInfo.x=this.touchInfo.x*this.drp,this.cursorInfo.y=this.touchInfo.y*this.drp):(this.cursorInfo.x=this.touchInfo.x*this.touchInfo.x_ratio*this.drp,this.cursorInfo.y=this.touchInfo.y*this.touchInfo.y_ratio*this.drp),console.log("touchInfo start",this.touchInfo.x,this.touchInfo.y),console.log("cursorInfo start",this.cursorInfo.x,this.cursorInfo.y),this.touchInfo.isDragging=!0,this.pickerColor=this.getImageRGB()},handleTouchMove(e){if(!this.touchInfo.isDragging)return;const s=e.touches[0],t=s.x-this.touchInfo.x,r=s.y-this.touchInfo.y;this.imgInfo.is_kuan?(this.cursorInfo.x+=t*this.drp,this.cursorInfo.y+=r*this.drp):(this.cursorInfo.x+=t*this.touchInfo.x_ratio*this.drp,this.cursorInfo.y+=r*this.touchInfo.y_ratio*this.drp),this.touchInfo.x=s.x,this.touchInfo.y=s.y,this.pickerColor=this.getImageRGB()},handleTouchEnd(){this.drawCursor(),this.touchInfo.isDragging=!1}},mounted(){console.log("onload"),this.sendPickerColors()}};function u(e,s,t,r,o,i){return h.e({a:o.imgInfo.url},o.imgInfo.url?{b:h.o((...n)=>i.handleTouchStart&&i.handleTouchStart(...n)),c:h.o((...n)=>i.handleTouchMove&&i.handleTouchMove(...n)),d:h.o((...n)=>i.handleTouchEnd&&i.handleTouchEnd(...n)),e:o.canvasInfo.tagwidth+"rpx",f:o.canvasInfo.tagheight+"rpx"}:{},{g:o.imgInfo.url},o.imgInfo.url?{h:h.o(n=>i.setCursorColor("red")),i:o.cursorInfo.color==="red"?"3px solid black":"1px solid black",j:o.cursorInfo.color==="red"?"white":"grey",k:h.o(n=>i.setCursorColor("black")),l:o.cursorInfo.color==="black"?"3px solid black":"1px solid black",m:o.cursorInfo.color==="black"?"white":"grey",n:h.o(n=>i.setCursorColor("white")),o:o.cursorInfo.color==="white"?"3px solid black":"1px solid black"}:{},{p:this.hexColor&&this.imgInfo.url},this.hexColor&&this.imgInfo.url?{q:o.squareSize+"px",r:o.squareSize+"px",s:o.hexColor,t:h.t(o.rgb),v:h.o((...n)=>i.addToDB&&i.addToDB(...n)),w:"6rpx solid "+this.hexColor}:{},{x:h.t(o.imgInfo.url?"Alter Image":"Add Image"),y:h.o((...n)=>i.addImage&&i.addImage(...n)),z:o.imgInfo.url},o.imgInfo.url?{A:h.o((...n)=>i.deleteImage&&i.deleteImage(...n))}:{})}const l=h._export_sfc(g,[["render",u],["__file","C:/Users/zxing/Desktop/pickercolor/pages/index/index.vue"]]);wx.createPage(l);
